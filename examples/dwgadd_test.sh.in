#!/bin/sh

top_builddir="@top_builddir@"
EXEEXT="@EXEEXT@"
srcdir="@srcdir@"
#srcdir=${srcdir:-$(dirname "$0")}
echo srcdir: "$srcdir"

dwgaddtest() {
    MG="$1"
    V="$2"
    if [ -z "$V" ]; then
        echo ./dwgadd "$srcdir"/dwgadd.example -o dwgadd_test.dwg
        ${top_builddir}/libtool --mode=execute "./dwgadd${EXEEXT}" "$srcdir"/dwgadd.example -o dwgadd_test.dwg
    else
        echo ./dwgadd -a "$V" "$srcdir"/dwgadd.example -o dwgadd_test.dwg
        ${top_builddir}/libtool --mode=execute "./dwgadd${EXEEXT}" -a "$V" "$srcdir"/dwgadd.example -o dwgadd_test.dwg
    fi
    ver=$(head -c6 dwgadd_test.dwg)
    if [ -z "$ver" ]
    then
        echo FAIL
        exit 1
    fi
    if [ "$ver" = "$MG" ]
    then
        echo PASS
    else
        echo FAIL "$ver != $MG"
        exit 1
    fi
}

dwgaddtest AC1015
dwgaddtest AC1015 r2000
dwgaddtest AC1012 r13
dwgaddtest AC1014 r14
dwgaddtest AC1.40 r1.4
#dwgaddtest AC1003 r2.6
#dwgaddtest AC2.10 r2.10
#dwgaddtest AC1004 r9
#dwgaddtest AC1006 r10
#dwgaddtest AC1009 r11
#dwgaddtest AC1018 r2004
#dwgaddtest AC1021 r2007
#dwgaddtest AC1024 r2010
#dwgaddtest AC1027 r2013
#dwgaddtest AC1032 r2018

rm dwgadd_test.dwg
